(()=>{"use strict";var t={19:function(t,n){var e,o=this&&this.__extends||(e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)},function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)});n.__esModule=!0;var r=function(){this.documents=new Map},i=function(){function t(t,n){this.field=t,this.action=n}return t.prototype.is=function(t){var n=this;return this.action.where((function(e){return e[n.field]==t}))},t.prototype.isnt=function(t){var n=this;return this.action.where((function(e){return e[n.field]!=t}))},t.prototype.greaterThan=function(t){var n=this;return this.action.where((function(e){return e[n.field]>t}))},t.prototype.lesserThan=function(t){var n=this;return this.action.where((function(e){return e[n.field]<t}))},t.prototype.greaterThanOrEqualTo=function(t){var n=this;return this.action.where((function(e){return e[n.field]>=t}))},t.prototype.lesserThanOrEqualTo=function(t){var n=this;return this.action.where((function(e){return e[n.field]<=t}))},t.prototype.isTrue=function(){var t=this;return this.action.where((function(n){return n[t.field]}))},t.prototype.isFalse=function(){var t=this;return this.action.where((function(n){return n[t.field]}))},t.prototype.has=function(t){var n=this;return this.action.where((function(e){return e[n.field].includes(t)}))},t.prototype.length=function(){return new c(this)},t}(),c=function(t){function n(n){return t.call(this,n.field,n.action)||this}return o(n,t),n.prototype.is=function(t){var n=this;return this.action.where((function(e){return e[n.field].length==t}))},n.prototype.isnt=function(t){var n=this;return this.action.where((function(e){return e[n.field].length!=t}))},n.prototype.greaterThan=function(t){var n=this;return this.action.where((function(e){return e[n.field].length>t}))},n.prototype.lesserThan=function(t){var n=this;return this.action.where((function(e){return e[n.field].length<t}))},n.prototype.greaterThanOrEqualTo=function(t){var n=this;return this.action.where((function(e){return e[n.field].length>=t}))},n.prototype.lesserThanOrEqualTo=function(t){var n=this;return this.action.where((function(e){return e[n.field].length<=t}))},n.prototype.isTrue=function(){throw Error("You can't evaluate length as a boolean")},n.prototype.isFalse=function(){throw Error("You can't evaluate length as a boolean")},n.prototype.has=function(t){throw Error("You can't evaluate length as an array")},n.prototype.length=function(){throw Error("You can't take the length of a length")},n}(i),u=function(){function t(t){this.document=t}return t.prototype.where=function(t){var n=this;return"string"==typeof t?new i(t,this):new Promise((function(e,o){chrome.storage.sync.get(n.document,(function(r){if(null!=r[n.document]){for(var i=[],c=0,u=r[n.document];c<u.length;c++){var a=u[c];for(var s in a)a[s]=JSON.parse(a[s]);t(a)&&i.push(a)}e(i)}else o("Error finding document "+n.document)}))}))},t.prototype.all=function(){var t=this;return new Promise((function(n,e){chrome.storage.sync.get(t.document,(function(o){if(null!=o[t.document]){for(var r=0;r<o[t.document].length;r++){var i=o[t.document][r];for(var c in i)i[c]=JSON.parse(i[c]);o[t.document][r]=i}n(o[t.document])}else e("Error finding document "+t.document)}))}))},t}(),a=function(){function t(t,n){this.document=t,this.values=n}return t.prototype.where=function(t){var n=this;return"string"==typeof t?new i(t,this):new Promise((function(e,o){chrome.storage.sync.get(n.document,(function(r){var i;if(null!=r[n.document]){for(var c=0;c<r[n.document].length;c++){var u=r[n.document][c];for(var a in u)u[a]=JSON.parse(u[a]);t(u)&&n.values.forEach((function(t,e){r[n.document][c][e]=JSON.stringify(t)}))}chrome.storage.sync.set(((i={})[n.document]=r,i),(function(){e(!0)}))}else o("Error finding document "+n.document)}))}))},t.prototype.all=function(){var t=this;return new Promise((function(n,e){chrome.storage.sync.get(t.document,(function(o){var r;if(null!=o[t.document]){for(var i=0;i<o[t.document].length;i++)t.values.forEach((function(n,e){o[t.document][i][e]=JSON.stringify(n)}));chrome.storage.sync.set(((r={})[t.document]=o,r),(function(){n(!0)}))}else e("Error finding document "+t.document)}))}))},t}(),s=function(){function t(t){this.name=t}return t.prototype.get=function(){return new u(this.name)},t.prototype.set=function(t){return new a(this.name,t)},t.prototype.add=function(t){var n=this;return new Promise((function(e,o){chrome.storage.sync.get(n.name,(function(r){var i;for(var c in t)t[c]=JSON.stringify(t[c]);null!=r[n.name]?(r[n.name].push(t),chrome.storage.sync.set(((i={})[n.name]=r[n.name],i),(function(){e(!0)}))):o("Error finding document "+n.name)}))}))},t.prototype.addAll=function(t){var n=this;return new Promise((function(e,o){chrome.storage.sync.get(n.name,(function(r){for(var i,c=0,u=t;c<u.length;c++){var a=u[c];for(var s in a)a[s]=JSON.stringify(a[s])}null!=r[n.name]?(r[n.name].addAll(t),chrome.storage.sync.set(((i={})[n.name]=r,i),(function(){e(!0)}))):o("Error finding document "+n.name)}))}))},t}(),f=function(){function t(){}return t.init=function(n){var e=new t;return e.database=n,new Promise((function(t,o){chrome.storage.sync.get("chromedb_config",(function(o){e.config=new r,e.config.documents,console.log("created config"),null!=o.chromedb_config?(e.config.documents=o.chromedb_config,n in e.config.documents||(e.config.documents[n]=[])):(console.log("setting empty"),e.config.documents[n]=[],console.log("setting empty")),t(e)}))}))},t.prototype.doc=function(t){if(this.config.documents[this.database].includes(t))return new s(t);throw Error("Document "+t+" doesn't belong to database "+this.database)},t.prototype.makeDoc=function(t){var n=this;return this.config.documents[this.database].includes(t)?new Promise((function(t,n){t(!1)})):new Promise((function(e,o){var r;chrome.storage.sync.set(((r={})[t]=[],r),(function(){n.config.documents[n.database].push(t),console.log("Added document: "+n.config.documents[n.database]),e(!0)}))}))},t.prototype.deleteDoc=function(t){var n=this;return new Promise((function(e,o){chrome.storage.sync.remove(t,(function(){n.config.documents[n.database].splice(n.config.documents[n.database].indexOf(t),1),e(!0)}))}))},t}();n.ChromeDB=f},367:function(t,n,e){var o=this&&this.__awaiter||function(t,n,e,o){return new(e||(e=Promise))((function(r,i){function c(t){try{a(o.next(t))}catch(t){i(t)}}function u(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){t.done?r(t.value):new e((function(n){n(t.value)})).then(c,u)}a((o=o.apply(t,n||[])).next())}))},r=this&&this.__generator||function(t,n){var e,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;c;)try{if(e=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=n.call(t,c)}catch(t){i=[6,t],o=0}finally{e=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};n.__esModule=!0;var i=e(19);o(this,void 0,void 0,(function(){var t,n;return r(this,(function(e){switch(e.label){case 0:return[4,i.ChromeDB.init("MyDB")];case 1:return[4,(t=e.sent()).makeDoc("MyDoc")];case 2:return e.sent(),[4,t.doc("MyDoc").add({id:0,content:"hello"})];case 3:return e.sent(),[4,t.doc("MyDoc").get().where("id").is(0)];case 4:return n=e.sent(),console.log(n),[2]}}))}))}},n={};!function e(o){if(n[o])return n[o].exports;var r=n[o]={exports:{}};return t[o].call(r.exports,r,r.exports,e),r.exports}(367)})();